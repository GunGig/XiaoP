<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>闯关学代码：解锁小P的“随机魔法”</title>
    <style>
        /* CSS Reset and Basic Styles */
        body, h1, h2, h3, h4, p, pre, code, ul, li, div {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            line-height: 1.8;
            background-color: #f0f2f5;
            color: #333;
            padding: 20px;
        }

        /* Main Container */
        .container {
            max-width: 900px;
            margin: 20px auto;
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 30px 40px;
            border: 1px solid #e8e8e8;
        }

        /* Headings */
        h1 {
            color: #2c3e50;
            font-size: 2.4em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .intro {
            font-size: 1.1em;
            color: #555;
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 20px;
        }

        /* Level Card Style */
        .level-card {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            transition: all 0.3s ease-in-out;
            border-left: 5px solid #3498db;
        }

        .level-card h2 {
            color: #3498db;
            font-size: 2em;
            margin-bottom: 20px;
        }
        
        h3 {
            color: #16a085;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .objective {
            font-style: italic;
            color: #7f8c8d;
            margin-bottom: 20px;
            padding: 10px 15px;
            background: #ecf0f1;
            border-radius: 6px;
            border-left: 3px solid #7f8c8d;
        }

        /* Code Blocks */
        pre {
            background-color: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            line-height: 1.6;
        }
        pre code {
            font-family: "Fira Code", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 0.95em;
        }
        
        /* Analysis & Example Sections */
        .analysis, .example-section {
            margin-top: 20px;
            padding: 15px;
            background: #fdfdfd;
            border: 1px dashed #ccc;
            border-radius: 8px;
        }
        .analysis h4, .example-section h4 {
            color: #27ae60;
            margin-bottom: 10px;
        }
        .analysis ul { list-style-position: inside; padding-left: 10px; }
        .analysis li { margin-bottom: 8px; }
        .analysis code, .example-section code {
            background-color: #e8e8e8;
            color: #c0392b;
            padding: 2px 5px;
            border-radius: 4px;
        }

        /* Quiz Section */
        .quiz-section {
            margin-top: 25px;
            padding: 20px;
            background-color: #fff8e1;
            border: 1px solid #ffecb3;
            border-radius: 8px;
        }
        .quiz-section h4 { color: #f39c12; }
        .quiz-options div { margin: 10px 0; }
        .quiz-options label { margin-left: 8px; cursor: pointer; }
        .feedback {
            margin-top: 10px;
            font-weight: bold;
            padding: 8px;
            border-radius: 4px;
            display: none;
        }
        .feedback.correct { color: #27ae60; background-color: #e8f5e9; }
        .feedback.incorrect { color: #c0392b; background-color: #fbe9e7; }

        /* Buttons */
        .quiz-submit-btn, .unlock-btn {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 1.05em;
            font-weight: bold;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quiz-submit-btn { background-color: #f39c12; }
        .quiz-submit-btn:hover { background-color: #e67e22; }
        .unlock-btn { background: linear-gradient(90deg, #3498db, #2980b9); }
        .unlock-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4); }
        .unlock-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #copy-button { /* Styles for the final copy button */ }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>闯关学代码：解锁小P的“随机魔法”</h1>
        <p class="intro">
            欢迎来到编程闯关挑战！每个关卡都包含“例子->应用->测验”三部曲。只有答对测验，才能解锁下一关。准备好，让我们开始真正的挑战吧！
        </p>

        <!-- Level 1: Import -->
        <div id="level-1" class="level-card">
            <h2>关卡 1：寻找魔法石 (import)</h2>
            <p class="objective">学习目标：理解什么是模块，以及如何使用 <code>import</code> 关键字来获取Python的内置“超能力”。</p>
            
            <div class="example-section">
                <h4>举个例子 🎲</h4>
                <p>除了随机数，Python还有一个数学模块 `math`。我们可以用它来做复杂的数学计算，比如开平方根。</p>
                <pre><code>import math

# 使用math模块里的sqrt函数计算16的平方根
result = math.sqrt(16)
print(result) # 输出将会是 4.0</code></pre>
            </div>

            <h3>应用到我们的项目中</h3>
            <pre><code>import random</code></pre>

            <div class="analysis">
                <h4>💡 代码解读</h4>
                <ul>
                    <li>这行代码是我们所有“随机魔法”的基础。它告诉Python：“请把 `random` 这个装满随机工具的工具箱拿过来，我接下来要用里面的工具。”</li>
                </ul>
            </div>
            
            <div class="quiz-section">
                <h4>🧠 小测验</h4>
                <p><code>import random</code> 这行代码的真正作用是什么？</p>
                <div class="quiz-options">
                    <div><input type="radio" id="q1a" name="quiz1" value="a"><label for="q1a">创建一个名为 random 的新变量。</label></div>
                    <div><input type="radio" id="q1b" name="quiz1" value="b" data-correct="true"><label for="q1b">引入一个名为 random 的模块，以便后续使用它提供的功能。</label></div>
                    <div><input type="radio" id="q1c" name="quiz1" value="c"><label for="q1c">在屏幕上打印出 "random" 这个单词。</label></div>
                </div>
                <button class="quiz-submit-btn" data-level="1">提交答案</button>
                <p class="feedback" id="feedback-1"></p>
            </div>
            
            <button class="unlock-btn" data-unlock="level-2" disabled>我已答对，进入下一关！</button>
        </div>

        <!-- Level 2: First Function -->
        <div id="level-2" class="level-card hidden">
            <h2>关卡 2：小试牛刀 (定义函数)</h2>
            <p class="objective">学习目标：学习定义第一个函数，处理字符串，并使用 `random.choice()` 从列表中随机选择一个元素。</p>

            <div class="example-section">
                <h4>举个例子 👋</h4>
                <p>函数就像一个可以重复使用的“配方”。下面这个函数可以向任何人打招呼。</p>
                <pre><code>def greet(name):
    print(f"你好, {name}！欢迎来到Python的世界。")

# 调用函数
greet("小明") # 输出: 你好, 小明！欢迎来到Python的世界。
greet("小红") # 输出: 你好, 小红！欢迎来到Python的世界。</code></pre>
            </div>

            <h3>应用到我们的项目中</h3>
            <pre><code>def random_choice_from_list(options_str):
    if not options_str:
        return "你还没有告诉我有什么选项呢！"
    options = [opt.strip() for opt in options_str.split(',') if opt.strip()]
    if not options:
        return "看起来你提供的选项都是空的哦。"
    return f"嗯... 我帮你选了：**{random.choice(options)}**！"</code></pre>

            <div class="analysis">
                <h4>💡 代码解读</h4>
                <ul>
                    <li><code>def...:</code> 定义了一个函数。</li>
                    <li><code>options_str.split(',')</code> 把用逗号连接的字符串（如"米饭,面条"）变成一个列表（<code>['米饭', '面条']</code>）。</li>
                    <li><code>random.choice(options)</code> 从列表中随机挑选一个元素。</li>
                </ul>
            </div>
            
            <div class="quiz-section">
                <h4>🧠 小测验</h4>
                <p>执行代码 `random.choice(['苹果', '香蕉', '橙子'])` 后，最可能得到下面哪一个结果？</p>
                <div class="quiz-options">
                    <div><input type="radio" id="q2a" name="quiz2" value="a"><label for="q2a">列表 `['苹果', '香蕉', '橙子']` 本身。</label></div>
                    <div><input type="radio" id="q2b" name="quiz2" value="b"><label for="q2b">一个包含单个水果的列表，比如 `['香蕉']`。</label></div>
                    <div><input type="radio" id="q2c" name="quiz2" value="c" data-correct="true"><label for="q2c">一个单独的水果字符串，比如 `'香蕉'`。</label></div>
                </div>
                <button class="quiz-submit-btn" data-level="2">提交答案</button>
                <p class="feedback" id="feedback-2"></p>
            </div>
            
            <button class="unlock-btn" data-unlock="level-3" disabled>函数和随机选择，Get！</button>
        </div>
        
        <!-- Level 3: Password Generation -->
        <div id="level-3" class="level-card hidden">
            <h2>关卡 3：创造守护咒 (循环与默认参数)</h2>
            <p class="objective">学习目标：学习使用循环生成指定长度的字符串，并了解函数的默认参数。</p>
            
            <div class="example-section">
                <h4>举个例子 ⏳</h4>
                <p>默认参数让函数更灵活。下面这个函数可以打印指定数量的点，如果不指定，就默认打印3个。</p>
                <pre><code>def print_dots(count=3):
    print("加载中", end="")
    for _ in range(count):
        print(".", end="")
    print() # 换行

print_dots()     # 输出: 加载中...
print_dots(5)    # 输出: 加载中.....</code></pre>
            </div>

            <h3>应用到我们的项目中</h3>
            <pre><code>def generate_random_password(length=8):
    chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
    password = "".join(random.choice(chars) for _ in range(length))
    return f"为你生成了一个{length}位的随机密码：**{password}**"</code></pre>
            
            <div class="analysis">
                <h4>💡 代码解读</h4>
                <ul>
                    <li><code>length=8</code> 就是默认参数。如果调用函数时不给长度，就用8。</li>
                    <li><code>for _ in range(length)</code> 会循环 `length` 次。</li>
                    <li><code>"".join(...)</code> 把每次循环选出的字符拼接成一个完整的字符串。</li>
                </ul>
            </div>
            
            <div class="quiz-section">
                <h4>🧠 小测验</h4>
                <p>有一个函数定义为 `def create_user(name, role="guest"):`，如果我们这样调用它：`create_user("Alice")`，那么在函数内部，变量 `role` 的值会是什么？</p>
                <div class="quiz-options">
                    <div><input type="radio" id="q3a" name="quiz3" value="a" data-correct="true"><label for="q3a">"guest"</label></div>
                    <div><input type="radio" id="q3b" name="quiz3" value="b"><label for="q3b">"Alice"</label></div>
                    <div><input type="radio" id="q3c" name="quiz3" value="c"><label for="q3c">程序会报错，因为缺少参数。</label></div>
                </div>
                <button class="quiz-submit-btn" data-level="3">提交答案</button>
                <p class="feedback" id="feedback-3"></p>
            </div>

            <button class="unlock-btn" data-unlock="level-4" disabled>循环和默认参数，没问题！</button>
        </div>
        
        <!-- Level 4: Interactive Game -->
        <div id="level-4" class="level-card hidden">
            <h2>关卡 4：大显身手 (交互与错误处理)</h2>
            <p class="objective">学习目标：掌握 `while` 循环、用户输入 `input()`、以及 `try-except` 错误处理，打造一个完整的交互式应用。</p>
            
             <div class="example-section">
                <h4>举个例子 🔑</h4>
                <p>我们可以用 `while` 和 `input` 做一个简单的密码验证程序，`try-except` 能防止用户输入奇怪的东西导致程序崩溃。</p>
                <pre><code>SECRET_CODE = 1234

while True:
    try:
        code_str = input("请输入密码 (数字): ")
        code_num = int(code_str) # 尝试把输入转成数字
        if code_num == SECRET_CODE:
            print("密码正确！")
            break # 跳出循环
        else:
            print("密码错误！")
    except ValueError:
        print("无效输入，请输入数字！")</code></pre>
            </div>

            <h3>应用到我们的项目中（猜数字游戏片段）</h3>
            <pre><code>while attempts < max_attempts:
    try:
        guess_str = input("请输入你猜的数字: ")
        guess = int(guess_str)
        # ... (判断大小的逻辑)
    except ValueError:
        print("请输入一个有效的数字！")</code></pre>
        
            <div class="analysis">
                <h4>💡 代码解读</h4>
                <ul>
                    <li><code>while ...:</code> 只要条件满足，循环就会一直继续。</li>
                    <li><code>input()</code> 暂停程序，等待用户输入。</li>
                    <li><code>try...except ValueError:</code> 尝试执行 `try` 块里的代码。如果用户输入的不是数字，<code>int()</code>会失败并引发 `ValueError`，程序会立刻跳转到 `except` 块，而不会崩溃。</li>
                </ul>
            </div>

            <div class="quiz-section">
                <h4>🧠 小测验</h4>
                <p>在猜数字游戏中，使用 `try...except` 结构的主要目的是什么？</p>
                <div class="quiz-options">
                    <div><input type="radio" id="q4a" name="quiz4" value="a"><label for="q4a">让游戏运行得更快。</label></div>
                    <div><input type="radio" id="q4b" name="quiz4" value="b" data-correct="true"><label for="q4b">防止当用户输入非数字内容（如'abc'）时程序崩溃。</label></div>
                    <div><input type="radio" id="q4c" name="quiz4" value="c"><label for="q4c">帮助电脑更快地猜到数字。</label></div>
                </div>
                <button class="quiz-submit-btn" data-level="4">提交答案</button>
                <p class="feedback" id="feedback-4"></p>
            </div>

            <button class="unlock-btn" data-unlock="level-5" disabled>交互和错误处理，太酷了！</button>
        </div>

        <!-- Level 5: The Menu -->
        <div id="level-5" class="level-card hidden">
            <h2>关卡 5：魔法菜单 (整合与启动)</h2>
            <p class="objective">学习目标：学习如何将所有函数组织起来，并通过一个主菜单和 `if __name__ == "__main__"` 来形成一个可独立运行的完整程序。</p>
            
            <h3>应用到我们的项目中</h3>
            <pre><code>def run_random_magic_menu():
    # ... (用 while True 和 if/elif/else 调用上面的所有函数)

# 只有当这个文件被直接运行时，才执行下面的代码
if __name__ == "__main__":
    print("测试随机魔法模块...")
    run_random_magic_menu()</code></pre>
            
            <div class="analysis">
                <h4>💡 代码解读</h4>
                <ul>
                    <li><code>run_random_magic_menu()</code> 函数是总指挥，它通过一个无限循环和 `if/elif/else` 判断来调用我们之前写好的各个功能函数。</li>
                    <li><code>if __name__ == "__main__":</code> 是Python程序的标准“启动器”。它确保 `run_random_magic_menu()` 只在这个文件被直接运行时才执行。如果这个文件被其他程序作为模块导入，这部分代码就不会运行，从而避免了不必要的麻烦。</li>
                </ul>
            </div>
            
             <div class="quiz-section">
                <h4>🧠 小测验</h4>
                <p>`if __name__ == "__main__":` 这段代码有什么特殊作用？</p>
                <div class="quiz-options">
                    <div><input type="radio" id="q5a" name="quiz5" value="a" data-correct="true"><label for="q5a">它下面的代码只有在该文件被直接执行时才会运行。</label></div>
                    <div><input type="radio" id="q5b" name="quiz5" value="b"><label for="q5b">它下面的代码只有在该文件被其他文件导入时才会运行。</label></div>
                    <div><input type="radio" id="q5c" name="quiz5" value="c"><label for="q5c">这是一个普通的if语句，没有特殊含义。</label></div>
                </div>
                <button class="quiz-submit-btn" data-level="5">提交答案</button>
                <p class="feedback" id="feedback-5"></p>
            </div>

            <button class="unlock-btn" data-unlock="final-challenge" disabled>我已全部通关！查看最终代码！</button>
        </div>

        <!-- Final Code -->
        <div id="final-challenge" class="level-card hidden">
            <!-- Final code block and copy button will be inserted here, similar to previous versions -->
            <h2>🏆 最终挑战：完整的魔法咒语 🏆</h2>
            <p class="objective">恭喜你，勇士！你已经掌握了“随机魔法”的所有秘密。下面是完整的代码，它将你学到的所有知识点组合在了一起。你可以将它完整地粘贴到 `magic_handler.py` 文件中。</p>
            <div style="position: relative;">
                <button id="copy-button" style="position: absolute; top: 15px; right: 15px; background-color: #e67e22; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; opacity: 0.8; transition: all 0.3s ease;">一键复制</button>
                <pre><code id="python-code"># XiaoP/random_magic/magic_handler.py
import random

def random_choice_from_list(options_str):
    """
    从用户提供的逗号分隔的选项中随机选择一个。
    """
    if not options_str:
        return "你还没有告诉我有什么选项呢！"
    options = [opt.strip() for opt in options_str.split(',') if opt.strip()]
    if not options:
        return "看起来你提供的选项都是空的哦。"
    return f"嗯... 我帮你选了：**{random.choice(options)}**！"

def generate_random_password(length=8):
    """生成一个指定长度的随机密码（包含大小写字母和数字）。"""
    if length < 4:
        return "密码长度至少要4位才能有点意义哦！"
    
    chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
    password = "".join(random.choice(chars) for _ in range(length))
    return f"为你生成了一个{length}位的随机密码：**{password}** (请妥善保管！)"

def guess_the_number_game():
    """一个简单的猜数字游戏。"""
    secret_number = random.randint(1, 100)
    attempts = 0
    max_attempts = 7

    print("\n--- 猜数字游戏开始！---")
    print("我已经想好了一个1到100之间的数字，你来猜猜看！")
    print(f"你总共有 {max_attempts} 次机会。")

    while attempts < max_attempts:
        try:
            guess_str = input(f"第 {attempts + 1} 次尝试，请输入你猜的数字 (1-100)，或输入 'q' 退出游戏: ")
            if guess_str.lower() == 'q':
                print(f"好吧，游戏结束。正确答案是 {secret_number}。")
                return
            
            guess = int(guess_str)
            attempts += 1

            if guess < 1 or guess > 100:
                print("请输入1到100之间的数字哦！")
                continue # 不计入有效尝试次数，让用户重新输入
            
            if guess < secret_number:
                print("太小了，再大一点试试！")
            elif guess > secret_number:
                print("太大了，再小一点试试！")
            else:
                print(f"🎉 恭喜你！在第 {attempts} 次猜中了！数字就是 {secret_number}！你真棒！")
                return 
        except ValueError:
            print("请输入一个有效的数字！或者输入 'q' 退出。")

    print(f"哎呀，机会用完了！正确答案是 {secret_number}。下次加油！💪")
    return

def run_random_magic_menu():
    """随机魔法功能的菜单"""
    print("\n✨ 小P的随机魔法屋 ✨")
    while True:
        print("\n你可以选择：")
        print("1. 帮我做选择 (比如今天吃什么？)")
        print("2. 生成一个随机密码")
        print("3. 玩猜数字游戏")
        print("0. 返回与小P聊天")

        choice = input("请输入你的选择 (0-3): ").strip()

        if choice == '1':
            options_input = input("请告诉我都有哪些选项，用逗号隔开 (比如：米饭,面条,饺子): ")
            result = random_choice_from_list(options_input)
            print(f"小P说：{result}")
        elif choice == '2':
            try:
                length_str = input("你希望密码有多少位？(建议8-16位，最少4位，直接回车默认为8): ")
                if not length_str:
                    length = 8
                else:
                    length = int(length_str)
                
                if length >= 4:
                    result = generate_random_password(length)
                    print(f"小P说：{result}")
                else:
                    print("小P说：密码长度至少要4位哦！")
            except ValueError:
                print("小P说：请输入一个有效的数字作为长度。")
        elif choice == '3':
            guess_the_number_game()
            print("游戏结束，已返回随机魔法屋。")
        elif choice == '0':
            print("已退出随机魔法屋。")
            break
        else:
            print("无效的选择，请输入0到3之间的数字哦！")

if __name__ == "__main__":
    print("测试随机魔法模块...")
    run_random_magic_menu()
</code></pre>
            </div>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Quiz and Unlock Logic ---
        const quizButtons = document.querySelectorAll('.quiz-submit-btn');
        quizButtons.forEach(button => {
            button.addEventListener('click', () => {
                const level = button.dataset.level;
                const quizForm = button.closest('.quiz-section');
                const selectedOption = quizForm.querySelector(`input[name="quiz${level}"]:checked`);
                const feedbackEl = document.getElementById(`feedback-${level}`);
                
                if (!selectedOption) {
                    feedbackEl.textContent = "请先选择一个答案！";
                    feedbackEl.className = 'feedback incorrect';
                    feedbackEl.style.display = 'block';
                    return;
                }

                const isCorrect = selectedOption.hasAttribute('data-correct');
                if (isCorrect) {
                    feedbackEl.textContent = "回答正确！太棒了！🎉";
                    feedbackEl.className = 'feedback correct';
                    
                    // Disable quiz and enable next level button
                    const levelCard = button.closest('.level-card');
                    const unlockButton = levelCard.querySelector('.unlock-btn');
                    unlockButton.disabled = false;
                    
                    // Disable the quiz inputs and submit button
                    quizForm.querySelectorAll('input, button').forEach(el => el.disabled = true);
                } else {
                    feedbackEl.textContent = "答案不对哦，再想想？🤔";
                    feedbackEl.className = 'feedback incorrect';
                }
                feedbackEl.style.display = 'block';
            });
        });

        // --- Unlock Button Logic ---
        const unlockButtons = document.querySelectorAll('.unlock-btn');
        unlockButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                if (button.disabled) return;

                const targetId = button.getAttribute('data-unlock');
                const nextLevel = document.getElementById(targetId);

                if (nextLevel) {
                    nextLevel.classList.remove('hidden');
                    nextLevel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    e.target.textContent = '已完成 ✔️';
                }
            });
        });

        // --- Copy Button Logic ---
        const copyButton = document.getElementById('copy-button');
        const codeBlock = document.getElementById('python-code');
        if (copyButton) {
            copyButton.addEventListener('click', () => {
                navigator.clipboard.writeText(codeBlock.innerText).then(() => {
                    copyButton.textContent = '已复制!';
                    copyButton.style.backgroundColor = '#2ecc71';
                    setTimeout(() => {
                        copyButton.textContent = '一键复制';
                        copyButton.style.backgroundColor = '#e67e22';
                    }, 2000);
                });
            }
        )};
    });
    </script>

</body>
</html>